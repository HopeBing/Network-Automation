# This has to be one of my favorite functions as it hard sometimes to find subnets in ACI. With this function you just enter the subnet 
# you want to find and it will let you know where it is.
# Of cource you will need to be logged in to apic via apic_login function that runs in MAIN. PLEASE SEE THE APIC LOGIN file.

def find_subnet():

    headers = {'content-type': 'text/xml'}
    uri_1 = "https://%s/api/class/fvBD.xml?query-target=subtree" % apic

    try:
        r = session.get(uri_1,verify=False, headers=headers)

        file = open(get_file, 'w')
        file.write(r.text)
        file.close()

        tree = ET.parse('C:\Python\ACI\Get_ACI.xml')
        root = tree.getroot()

        line = 5
        subnet_array = []

        for fvSubnet in root.iter("fvSubnet"):
            subnets = fvSubnet.get("ip")
            subnet_array.append(subnets)
            print("Gateway: : %s" % subnets)

    except UnboundLocalError:
        print("\n")
        print("403 Forbidden - Please log into APIC to vew or push configurations")
        print("\n")
        apic_login()
    except NameError:
        print("\n")
        print("Unknown Error. Relogging into APIC")
        print("\n")
        apic_login()

    print("\n")
    print("Enter gateway IP plus prefix length (ex. 1.1.1.1/24)")
    subnet_id = input("Please enter a gateway IP: ")

    headers = {'content-type': 'text/xml'}
    uri_2 = "https://%s/api/class/fvBD.xml?query-target=subtree" % apic

    try:
        r = session.get(uri_2,verify=False, headers=headers)

        file = open(get_file, 'w')
        file.write(r.text)
        file.close()

        tree = ET.parse('C:\Python\ACI\Get_ACI.xml')
        root = tree.getroot()

        for fvSubnet in root.iter("fvSubnet"):
            location = fvSubnet.get("dn")
            ip = fvSubnet.get("ip")
            if subnet_id in ip:
                print("\n")
                print (location)

    ##########################################################
    # The follwing two exceptions will be thrown in you dont log in to the APIC
    ######################################### ################

    except UnboundLocalError:
        print("\n")
        print("403 Forbidden - Please log into APIC to vew or push configurations")
        print("\n")
        apic_login()
    except NameError:
        print("\n")
        print("Unknown Error. Relogging into APIC")
        print("\n")
        apic_login()
